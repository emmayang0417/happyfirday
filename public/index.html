<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>123456</title>
    <script>
    document.write('<base href="' + document.location + '" />');
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.4/nv.d3.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.9/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.1/nv.d3.min.js"></script>
    <script src="https://rawgit.com/krispo/angular-nvd3/v1.0.4/dist/angular-nvd3.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.0.js"></script>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <script>
    (function() {
        var app = angular.module('plunker', ['nvd3']);
        app.controller('MainCtrl', function($scope, $interval) {
            $scope.options = {
                chart: {
                    type: 'discreteBarChart',
                    height: 450,
                    margin: {
                        top: 20,
                        right: 20,
                        bottom: 50,
                        left: 55
                    },
                    x: function(d) {
                        return d.label;
                    },
                    y: function(d) {
                        return d.value + (1e-10);
                    },
                    showValues: true,
                    valueFormat: function(d) {
                        return d3.format(',.4f')(d);
                    },
                    duration: 500,
                    xAxis: {
                        axisLabel: 'X Axis'
                    },
                    yAxis: {
                        axisLabel: 'Y Axis',
                        axisLabelDistance: -10
                    }
                }
            };
            console.log("asd")
            $scope.data = [{
                key: "Cumulative Return",
                values: [{
                    "label": "throttle_pos",
                    "value": 0
                }, {
                    "label": "acc_pedal_pos_d",
                    "value": 0
                }, {
                    "label": "speed",
                    "value": 0
                }, {
                    "label": "rpm",
                    "value": 0
                }, {
                    "label": "maf",
                    "value": 0
                }, {
                    "label": "engine_fuel_rate",
                    "value": 0
                }]
            }]

            $scope.draw = function(data) {
                console.log(data)
                console.log($scope.options)
                console.log(typeof data.speed)
                $scope.data[0].values[0].value = parseFloat(data.throttle_pos)
                $scope.data[0].values[1].value = parseFloat(data.acc_pedal_pos_d)
                $scope.data[0].values[2].value = parseFloat(data.speed)
                $scope.data[0].values[3].value = parseFloat(data.rpm)
                $scope.data[0].values[4].value = parseFloat(data.maf)
                $scope.data[0].values[5].value = parseFloat(data.engine_fuel_rate)
                console.log($scope.data[0].values[0].value)
                $scope.$digest()
            }
            window.draw = $scope.draw

            $interval(fetchData, 3000, 5000, true);
        });
    })()
    </script>

    <script type="text/javascript">
      google.charts.load('current', {'packages':['gauge']});
      google.charts.setOnLoadCallback(drawChart);
      function drawChart() {

        var data = google.visualization.arrayToDataTable([
          ['Label', 'Value'],
          ['Temperture', 80]
        ]);

        var options = {
          width: 400, height: 120,
          redFrom: 90, redTo: 100,
          yellowFrom:75, yellowTo: 90,
          minorTicks: 5
        };

        var chart = new google.visualization.Gauge(document.getElementById('chart_div'));

        chart.draw(data, options);

        setInterval(function() {
          fetchData2();
          data.setValue
          chart.draw(data, options);
        }, 13000);
      }
    </script>
</head>

</html>
<div id="sitebody">
    <div id="content">

        <body ng-app="plunker" ng-controller="MainCtrl">
            <nvd3 options="options" data="data" class="with-3d-shadow with-transitions"></nvd3>
        </body>
    </div>
    <div id="content">

        <body ng-controller="MainCtrl">
            <nvd3 options="options" data="data" class="with-3d-shadow with-transitions"></nvd3>
        </body>
    </div>
</div>

<body>
    <script>
    function fetchData() {
        var resdata = {};
        var hasData = false;

        $.ajax({
            url: "https://obd2cloud.apps.exosite.io/development/storage/keyvalue?device=als7061",
            type: "GET",
            // dataType: "json",
            success: function(res) {
                var json = JSON.parse(res.split('\n')[1]).value
                resdata = JSON.parse(json)
                console.log("B")
                console.log(resdata)

                hasData = true;
                window.draw(resdata)
            },
            crossDomain: true,
            error: function(err) {
                console.log(err)
                hasData = false;
            },
            statusCode: {
                504: function() {
                    console.log("server not responding");
                    $("#appstatus").text('Server Not Responding 504');
                    $("#appstatus").css('color', red_color);
                }
            },
            timeout: 1000
        });
        console.log(hasData)
        hasData = "false";
    }
    </script>

    <script>
    function fetchData2() {
        var resdata2 = {};
        var hasData = false;

        $.ajax({
            url: "https://obd2cloud.apps.exosite.io/development/storage/keyvalue?device=als7061",
            type: "GET",
            // dataType: "json",
            success: function(res) {
                var json = JSON.parse(res.split('\n')[1]).value
                resdata2 = JSON.parse(json)
                console.log("B")
                console.log(resdata2)

                hasData = true;
                window.draw(resdata2)
            },
            crossDomain: true,
            error: function(err) {
                console.log(err)
                hasData = false;
            },
            statusCode: {
                504: function() {
                    console.log("server not responding");
                    $("#appstatus").text('Server Not Responding 504');
                    $("#appstatus").css('color', red_color);
                }
            },
            timeout: 1000
        });
        console.log(hasData)
        hasData = "false";
    }
    </script>

</body>

</html>
<style type="text/css">
#sitebody {
    width: 600px;
    margin: 0 auto;
    font-size: 13px;
}

#header {
    background-color: #FFD4D4;
    height: 80px;
    text-align: center;
    line-height: 80px;
}

#sidebar_left {
    background-color: #FFECC9;
    width: 120px;
    height: 400px;
    text-align: center;
    line-height: 400px;
    float: left;
}

#sidebar_right {
    background-color: #FFECC9;
    width: 120px;
    height: 400px;
    text-align: center;
    line-height: 400px;
    float: right;
}

#content {
    margin-left: 40px;
    margin-right: 40px;
    height: 400px;
    background-color: #F2FFF2;
    text-align: center;
    line-height: 400px;
}

#footer {
    clear: both;
    background-color: #FFD4D4;
    height: 80px;
    text-align: center;
    line-height: 80px;
}
</style>
